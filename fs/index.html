
<!DOCTYPE html>
<html>
  <head>
    
    <script src="./NexusUI.min.js"></script>
    <script src="./magic_grid.min.js"></script>

    <style>
      .container div {
        width: 100%;
        height: 100%;
        background-color: antiquewhite;
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 8px;
      }
      .container .item1 { height: 200px; }
      .container .item2 { height: 200px; }
      .container .item3 { height: 600px; }
      .container .item4 { height: 400px; }
    </style>    
  </head>
  <body>

    <div id="container">
      <div id="item1">
        Datasets
        <div id="datasetSelector"></div>
      </div>
      <div id="item2">
        Models
        <div id="modelSelector"></div>
      </div>
      <div id="item3">   
        <div id="slider1"></div>
        <div id="slider2"></div>
        <div id="slider3"></div>
        <div id="slider4"></div>
      </div>
      <div id="item4">   
        <div id="button1"></div>
        <div id="button2"></div>
        <div id="button3"></div>
        <div id="button4"></div>
      </div>
    </div>
    <div id="debug">
      Debug:
      <span id="debugstr">replaceme</span>
    </div>
    

    <script>

      let grid = new MagicGrid({container: "#container", // Required. Can be a class, id, or an HTMLElement.
        static: true, // Required for static content.
        animate: true} // Optional.
        );

      console.log(grid);
      grid.listen();

      const slider_queue = [];

      function queue(message) {
        slider_queue.push(message)  
      }


      function run() {
        if (slider_queue.length > 0) {
          // Take the last element
          const work = slider_queue[slider_queue.length - 1];
          if (work !== undefined) {
            const idx = work[0];
            const val = work[1];
            fetch("/dials.cgi?s=" + idx + "&v=" + val);
          }
          // Clear array
          slider_queue.length = 0;
        }
      }

      setInterval(run, 100);

      var datasetRadios = new Nexus.RadioButton('#datasetSelector',{
        'size': [150,35],
        'numberOfButtons': 4,
        'active': 0
      })
      var modelRadios = new Nexus.RadioButton('#modelSelector',{
        'size': [150,35],
        'numberOfButtons': 4,
        'active': 0
      })

      var slider1 = new Nexus.Slider('#slider1',{
          'size': [150,50],
          'mode': 'relative',  // 'relative' or 'absolute'
          'min': 0,
          'max': 1,
          'step': 0,
          'value': 0
      })
      slider1.on('change',function(v) {
        // v is the value of the button
        console.log(v);
        slider_queue.push([0, v]);
      })
      var slider2 = new Nexus.Slider('#slider2',{
          'size': [150,50],
          'mode': 'relative',  // 'relative' or 'absolute'
          'min': 0,
          'max': 1,
          'step': 0,
          'value': 0
      })
      var slider3 = new Nexus.Slider('#slider3',{
          'size': [150,50],
          'mode': 'relative',  // 'relative' or 'absolute'
          'min': 0,
          'max': 1,
          'step': 0,
          'value': 0
      })
      var slider4 = new Nexus.Slider('#slider4',{
          'size': [150,50],
          'mode': 'relative',  // 'relative' or 'absolute'
          'min': 0,
          'max': 1,
          'step': 0,
          'value': 0
      })

      /**
       * BUTTONS
       */

      var button1 = new Nexus.Button('#button1',{
        'size': [75,75],
        'mode': 'aftertouch',
        'state': false
      })
      button1.on('change',function(v) {
        // v is the value of the button
        console.log(v.state);
        fetch("/buttons.cgi?b=0&v=" + (v.state ? 1 : 0));
      })
      var button2 = new Nexus.Button('#button2',{
        'size': [75,75],
        'mode': 'aftertouch',
        'state': false
      })
      button2.on('change',function(v) {
        // v is the value of the button
        console.log(v.state);
        fetch("/buttons.cgi?b=1&v=" + (v.state ? 1 : 0));
      })

      var button3 = new Nexus.Button('#button3',{
        'size': [75,75],
        'mode': 'aftertouch',
        'state': false
      })
      button3.on('change',function(v) {
        // v is the value of the button
        console.log(v.state);
        fetch("/buttons.cgi?b=2&v=" + (v.state ? 1 : 0));
      })
      var button4 = new Nexus.Button('#button4',{
        'size': [75,75],
        'mode': 'aftertouch',
        'state': false
      })
      button4.on('change',function(v) {
        // v is the value of the button
        console.log(v.state);
        fetch("/buttons.cgi?b=3&v=" + (v.state ? 1 : 0));
      })

      // var dial = new Nexus.Dial('#dial')
      // dial.on('change',function(v) {
      //   if (work_queue.length == 0) {
      //     work_queue.push(v);
      //   }
      // });
      // var dial = new Nexus.Dial('#dial2')
      // var sequencer = new Nexus.Sequencer('#seq',{
      //   'size': [400,200],
      //   'mode': 'toggle',
      //   'rows': 5,
      //   'columns': 10,
      //   'paddingRow': 10,
      //   'paddingColumn': 20
      //   })

      async function getJSON() {
        const response = await fetch("/ssi.shtml");
        if (!response.ok) {
            console.log("poll error")
          }
          // Parse the response as JSON
          const data = await response.json();
          console.log(data);    
          document.getElementById('debugstr').innerText = data.test;  

      }
      setInterval(getJSON, 500);

    </script>


  </body>
</html>